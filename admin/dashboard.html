<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ManiMagic - Admin Dashboard</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/calendar.css">
    <style>
        /* Admin Specific Overrides */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 250px 1fr;
            height: 100vh;
        }

        .sidebar {
            background: var(--glass-bg);
            border-right: var(--glass-border);
            padding: 2rem;
        }

        .content {
            padding: 3rem;
            overflow-y: auto;
        }

        .nav-item {
            display: block;
            padding: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .nav-item:hover,
        .nav-item.active {
            background-color: var(--secondary-color);
            color: var(--dark-bg);
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="dashboard-grid">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h2 class="brand-title" style="font-size: 1.5rem; text-align: left; margin-bottom: 2rem;">ManiMagic Admin
            </h2>
            <nav>
                <a href="dashboard.html" class="nav-item active"> Calendario</a>
                <a href="inventory.html" class="nav-item"> Inventario</a>
                <a href="clients.html" class="nav-item"> Clientes</a>
                <a href="../index.html" class="nav-item" style="margin-top: auto; color: var(--accent-color);">Cerrar
                    Sesi贸n</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <h1 style="font-family: var(--font-heading); margin-bottom: 1rem;">Panel de Control</h1>
            <div class="auth-card" style="width: 100%; max-width: 1000px; margin-bottom: 2rem;">
                <h2 style="font-family: var(--font-heading); margin-bottom: 1rem;">锔 Configuraci贸n de Disponibilidad
                </h2>
                <form id="availabilityForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Working Days -->
                        <div>
                            <p class="form-label">D铆as Laborales:</p>
                            <label><input type="checkbox" name="days" value="1" checked> Lunes</label><br>
                            <label><input type="checkbox" name="days" value="2" checked> Martes</label><br>
                            <label><input type="checkbox" name="days" value="3" checked> Mi茅rcoles</label><br>
                            <label><input type="checkbox" name="days" value="4" checked> Jueves</label><br>
                            <label><input type="checkbox" name="days" value="5" checked> Viernes</label><br>
                            <label><input type="checkbox" name="days" value="6" checked> S谩bado</label><br>
                            <label><input type="checkbox" name="days" value="0"> Domingo</label>
                        </div>

                        <!-- Hours -->
                        <div>
                            <div class="form-group">
                                <label class="form-label">Hora de Inicio:</label>
                                <input type="time" id="startTime" class="form-input" value="09:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Hora de Fin:</label>
                                <input type="time" id="endTime" class="form-input" value="18:00">
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary" style="margin-top: 1rem; width: auto;">Guardar
                        Horarios</button>
                </form>
            </div>

            <!-- Pending Appointments Section -->
            <div class="auth-card" style="width: 100%; max-width: 1000px; margin-bottom: 2rem;">
                <h2 style="font-family: var(--font-heading); margin-bottom: 1rem;"> Citas Programadas</h2>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: var(--secondary-color); text-align: left;">
                                <th style="padding: 1rem;">Fecha/Hora</th>
                                <th style="padding: 1rem;">Cliente</th>
                                <th style="padding: 1rem;">Servicio</th>
                                <th style="padding: 1rem;">Contacto</th>
                                <th style="padding: 1rem;">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="appointmentsTableBody">
                            <!-- JS will inject rows here -->
                            <tr>
                                <td colspan="5" style="padding:1rem; text-align:center;">Cargando citas...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal for Completing Appointment (Price) -->
            <div id="completeModal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1100;">
                <div class="auth-card" style="width:90%; max-width:400px; position:relative;">
                    <button id="closeCompleteModal"
                        style="position:absolute; top:1rem; right:1rem; border:none; background:none; font-size:1.2rem; cursor:pointer;">&times;</button>
                    <h2 style="margin-bottom:1rem;">Finalizar Cita</h2>
                    <p style="margin-bottom:1rem;">Ingresa el monto cobrado por este servicio:</p>

                    <div class="form-group">
                        <label class="form-label">Precio ($):</label>
                        <input type="number" id="servicePrice" class="form-input" placeholder="0.00" min="0">
                    </div>

                    <button id="confirmCompleteBtn" class="btn-primary">Guardar y Finalizar</button>
                </div>
            </div>

            <div class="auth-card" style="width: 100%; max-width: 1000px;">
                <!-- Calendar Component -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prevMonth">&lt;</button>
                        <h2 class="calendar-title" id="currentMonthLabel">Cargando...</h2>
                        <button class="calendar-nav-btn" id="nextMonth">&gt;</button>
                    </div>

                    <div class="calendar-grid" id="calendarGrid">
                        <!-- JS will inject days here -->
                    </div>
                </div>
            </div>

            <!-- Modal para Gestionar D铆a -->
            <div id="dayModal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
                <div class="auth-card" style="width:90%; max-width:400px; position:relative;">
                    <button id="closeModal"
                        style="position:absolute; top:1rem; right:1rem; border:none; background:none; font-size:1.2rem; cursor:pointer;">&times;</button>
                    <h2 id="modalDateTitle" style="margin-bottom:1rem;">Gestionar Fecha</h2>

                    <div class="form-group">
                        <label class="form-label">Estado del D铆a:</label>
                        <select id="dayStatus" class="form-input">
                            <option value="open">Abierto (Normal)</option>
                            <option value="closed">Cerrado (Bloqueado)</option>
                        </select>
                    </div>

                    <div id="customHoursBlock">
                        <p style="font-size:0.9rem; margin-bottom:0.5rem; color:var(--accent-color);">Horario Especial
                            (Opcional):</p>
                        <div class="form-group">
                            <label class="form-label">Inicio:</label>
                            <input type="time" id="dayStart" class="form-input">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Fin:</label>
                            <input type="time" id="dayEnd" class="form-input">
                        </div>
                    </div>

                    <button id="saveDayBtn" class="btn-primary">Guardar Cambios</button>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { saveAvailabilitySettings, loadAvailabilitySettings } from '../js/availability.js';
        import { initCalendar } from '../js/calendar-admin.js';
        import { initAppointmentsAdmin } from '../js/appointments-admin.js';

        // Cargar configuraci贸n al iniciar
        window.addEventListener('DOMContentLoaded', async () => {
            initCalendar(); // Init dynamic calendar
            initAppointmentsAdmin(); // Load Appointments Table

            const settings = await loadAvailabilitySettings();
            if (settings) {
                // Set Times
                document.getElementById('startTime').value = settings.startTime;
                document.getElementById('endTime').value = settings.endTime;

                // Set Days
                const checkboxes = document.querySelectorAll('input[name="days"]');
                checkboxes.forEach(cb => {
                    cb.checked = settings.workDays.includes(parseInt(cb.value));
                });
            }
        });

        // Guardar configuraci贸n
        document.getElementById('availabilityForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;

            const checkboxes = document.querySelectorAll('input[name="days"]:checked');
            const days = Array.from(checkboxes).map(cb => parseInt(cb.value));

            await saveAvailabilitySettings(days, start, end);
        });
    </script>
</body>

</html>